
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>Trip to Qingdao & Yantai</title>
        <style>
            :root {
                --bg-color: #F2F2F7;
                --text-primary: #1C1C1E;
                --text-secondary: #8E8E93;
                --system-blue: #007AFF;
                --separator: #E5E5EA;
            }
            body {
                font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
                background-color: var(--bg-color);
                color: var(--text-primary);
                margin: 0; padding: 0;
                padding-bottom: 100px;
            }

            /* ÂØºËà™Ê†è */
            .nav-bar {
                background: rgba(242, 242, 247, 0.9);
                backdrop-filter: blur(10px);
                position: sticky; top: 0; z-index: 100;
                padding: 15px 20px;
                border-bottom: 1px solid rgba(0,0,0,0.1);
            }
            .nav-title { font-size: 13px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
            .nav-large-title { font-size: 28px; font-weight: 800; margin-top: 5px; }

            /* È¢ÑÁÆóÂç°Áâá */
            .budget-card {
                margin: 20px; padding: 20px;
                background: linear-gradient(135deg, #0A84FF, #5E5CE6);
                border-radius: 20px; color: white;
                box-shadow: 0 8px 20px rgba(10, 132, 255, 0.3);
            }
            .budget-row { display: flex; justify-content: space-between; align-items: flex-end; }
            .budget-amt { font-size: 32px; font-weight: 700; }
            .budget-progress { margin-top: 15px; height: 6px; background: rgba(0,0,0,0.2); border-radius: 3px; overflow: hidden; }
            .budget-bar { height: 100%; background: rgba(255,255,255,0.9); border-radius: 3px; }

            /* Ë°åÁ®ã */
            .day-container { margin: 25px 20px; }
            .day-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px; padding: 0 5px; }
            .day-date { font-size: 20px; font-weight: 700; }
            .day-weekday { font-size: 14px; color: var(--text-secondary); font-weight: 600; text-transform: uppercase; }

            .card { background: #fff; border-radius: 18px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow: hidden; }

            /* Â§©Ê∞î */
            .weather-widget {
                padding: 15px 20px; background: linear-gradient(to right, #E0F7FA, #F0F4F8);
                display: flex; align-items: center; border-bottom: 1px solid var(--separator);
            }
            .weather-temp { font-weight: 600; font-size: 17px; margin-left: 10px; }
            .weather-desc { font-size: 13px; color: var(--text-secondary); margin-left: auto; }

            /* ÂàóË°® */
            .activity-list { list-style: none; padding: 0; margin: 0; }
            .activity-item { display: flex; padding: 16px 20px; border-bottom: 1px solid var(--separator); }
            .activity-item:last-child { border-bottom: none; }

            .time-col { width: 50px; font-weight: 600; color: var(--text-secondary); font-size: 15px; flex-shrink: 0; padding-top: 2px; }
            .content-col { flex-grow: 1; margin-left: 10px; }
            .act-title { font-size: 17px; font-weight: 500; margin-bottom: 4px; }
            .act-sub { font-size: 13px; color: var(--text-secondary); background: #F2F2F7; padding: 4px 8px; border-radius: 6px; display: inline-block; }

            /* ÂõæÊ†á */
            .icon { margin-right: 5px; font-style: normal; }

            /* ÁºñËæëÊ®°Âºè */
            .editing .act-title, .editing .act-sub, .editing .time-col { 
                background: rgba(0,122,255,0.1); border-radius: 4px; min-width: 20px; 
            }
            .delete-btn { display: none; color: #FF3B30; font-weight: bold; margin-left: 10px; cursor: pointer; }
            .editing .delete-btn { display: block; }

            /* Â∫ïÈÉ®ÊåâÈíÆ */
            .bottom-bar {
                position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
                background: rgba(28,28,30,0.9); backdrop-filter: blur(20px);
                padding: 10px 15px; border-radius: 30px; display: flex; gap: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 200;
            }
            .btn { background: none; border: none; color: white; font-weight: 600; font-size: 14px; padding: 8px 16px; border-radius: 20px; cursor: pointer; }
            .btn:active { background: rgba(255,255,255,0.2); }
            .btn.save { color: #30D158; }
            .btn.reset { color: #FF453A; }
        </style>
    </head>
    <body>
        <div id="app"></div>

        <div class="bottom-bar">
            <button class="btn" id="editBtn" onclick="toggleEdit()">ÁºñËæë</button>
            <button class="btn save" id="saveBtn" onclick="saveData()" style="display:none">‰øùÂ≠ò</button>
            <button class="btn reset" id="resetBtn" onclick="resetData()" style="display:none">ÈáçÁΩÆ</button>
        </div>

        <script>
            const DEFAULT_DATA = {"title": "Trip to Qingdao & Yantai", "subtitle": "È´òÂøóËà™ & ‰ªá‰πêË®Ä ¬∑ 2026", "budget": {"total": 4000, "spent": 1740.6399999999999}, "locations": {"ÈùíÂ≤õ": {"lat": 36.0671, "lon": 120.3826}, "ÁÉüÂè∞": {"lat": 37.4638, "lon": 121.4479}, "È´òÈÇÆ": {"lat": 32.7833, "lon": 119.4333}}, "itinerary": [{"id": "day1", "date": "2026-02-09", "weekday": "Âë®‰∏Ä", "city": "ÈùíÂ≤õ", "title": "ÊäµËææÈùíÂ≤õ & ÂÖ•‰Ωè", "activities": [{"time": "09:10", "type": "transport", "text": "È´òÈÇÆÁ´ôÂá∫Âèë (D2866)", "sub": "05ËΩ¶ 11A | Âèå‰∫∫Á•®: ¬•386"}, {"time": "14:30", "type": "hotel", "text": "ÂÖ•‰Ωè: Êµ∑ÂèãÈùíÂ≤õ‰∫îÂõõÂπøÂú∫", "sub": "ÂÖ•‰ΩèÁ†Å: GE2243 | ÂÆ∂Â∫≠Êàø"}, {"time": "16:00", "type": "warning", "text": "ÈÅøÈõ∑ÊèêÈÜí", "sub": "‰∏çÂéªÂ§ßÂ≠¶Ë∑ØÔºå‰∫∫Â§ö‰∏îÁ¥Ø"}, {"time": "16:30", "type": "sight", "text": "Â••Â∏Ü‰∏≠ÂøÉ & ÊÉÖ‰∫∫Âùù", "sub": "Êó•ËêΩÁªù‰Ω≥ËßÇÊµãÁÇπ"}]}, {"id": "day2", "date": "2026-02-10", "weekday": "Âë®‰∫å", "city": "ÈùíÂ≤õ", "title": "Â∞èÈ∫¶Â≤õ & ÂÖ´Â§ßÂÖ≥", "activities": [{"time": "09:00", "type": "sight", "text": "ÂÖ´Â§ßÂÖ≥È£éÊôØÂå∫", "sub": "‰∏áÂõΩÂª∫Á≠ëÁæ§"}, {"time": "12:00", "type": "food", "text": "ÂçàÈ§êÔºöËàπÊ≠åÈ±ºÊ∞¥È•∫", "sub": "Êé®ËçêÂ¢®È±ºÊ∞¥È•∫"}, {"time": "14:30", "type": "sight", "text": "Â∞èÈ∫¶Â≤õÂÖ¨Âõ≠", "sub": "Áé∞ÂÆûÁâà'Â°ûÂ∞îËææ'ËçâÂú∞"}]}, {"id": "day3", "date": "2026-02-11", "weekday": "Âë®‰∏â", "city": "ÁÉüÂè∞", "title": "ËΩ¨ÊàòÁÉüÂè∞", "activities": [{"time": "10:29", "type": "transport", "text": "ÈùíÂ≤õÁ´ôÂá∫Âèë (C6568)", "sub": "Âèå‰∫∫Á•®: ¬•160 | ËÄÅÁÅ´ËΩ¶Á´ô"}, {"time": "14:00", "type": "hotel", "text": "ÂÖ•‰Ωè: ‰Ω†Â•ΩÁÉüÂè∞‰∫åÈ©¨Ë∑Ø", "sub": "ÂÖ•‰ΩèÁ†Å: DGJ253 | Êµ∑ÊôØÊàø"}, {"time": "18:00", "type": "food", "text": "ÊôöÈ§ê: ÁÉüÂè∞Â∞èÊµ∑È≤ú", "sub": "Êª®Êµ∑ÂπøÂú∫ÈôÑËøë"}]}, {"id": "day4", "date": "2026-02-12", "weekday": "Âë®Âõõ", "city": "ÁÉüÂè∞", "title": "ÂÖªÈ©¨Â≤õÁéØÂ≤õ", "activities": [{"time": "09:00", "type": "transport", "text": "ÂâçÂæÄÂÖªÈ©¨Â≤õ", "sub": "ÊâìËΩ¶Á∫¶40ÂàÜÈíü"}, {"time": "10:30", "type": "activity", "text": "ÁßüÁîµÂä®ËΩ¶ÁéØÂ≤õ", "sub": "Êµ∑Ëû∫Ê¥û„ÄÅÊ®üÂ≤õ„ÄÅÁß¶È£éÂ¥ñ"}, {"time": "16:00", "type": "sight", "text": "ËøîÁ®ãÁúãÊó•ËêΩ", "sub": "Êµ∑È£éÂ§ßÔºåÊ≥®ÊÑè‰øùÊöñ"}]}, {"id": "day5", "date": "2026-02-13", "weekday": "Âë®‰∫î", "city": "È´òÈÇÆ", "title": "ËøîÁ®ã", "activities": [{"time": "15:12", "type": "transport", "text": "D2872 (ÁÉüÂè∞ -> È´òÈÇÆ)", "sub": "‚ö†Ô∏è ÈúÄË¥≠Âèå‰∫∫Á•®"}, {"time": "19:42", "type": "home", "text": "ÊäµËææÈ´òÈÇÆ", "sub": "Ë°åÁ®ãÁªìÊùü"}]}]};
            let appData = {};
            let isEditing = false;
            let weatherCache = {};
            const ICONS = { transport: "üöÑ", hotel: "üè®", sight: "üì∑", food: "üç¥", activity: "üö≤", home: "üè†", warning: "‚ö†Ô∏è" };

            async function init() {
                const local = localStorage.getItem('appleTrip_final');
                appData = local ? JSON.parse(local) : JSON.parse(JSON.stringify(DEFAULT_DATA));
                render();
                await fetchWeather();
            }

            async function fetchWeather() {
                const locs = {"title": "Trip to Qingdao & Yantai", "subtitle": "È´òÂøóËà™ & ‰ªá‰πêË®Ä ¬∑ 2026", "budget": {"total": 4000, "spent": 1740.6399999999999}, "locations": {"ÈùíÂ≤õ": {"lat": 36.0671, "lon": 120.3826}, "ÁÉüÂè∞": {"lat": 37.4638, "lon": 121.4479}, "È´òÈÇÆ": {"lat": 32.7833, "lon": 119.4333}}, "itinerary": [{"id": "day1", "date": "2026-02-09", "weekday": "Âë®‰∏Ä", "city": "ÈùíÂ≤õ", "title": "ÊäµËææÈùíÂ≤õ & ÂÖ•‰Ωè", "activities": [{"time": "09:10", "type": "transport", "text": "È´òÈÇÆÁ´ôÂá∫Âèë (D2866)", "sub": "05ËΩ¶ 11A | Âèå‰∫∫Á•®: ¬•386"}, {"time": "14:30", "type": "hotel", "text": "ÂÖ•‰Ωè: Êµ∑ÂèãÈùíÂ≤õ‰∫îÂõõÂπøÂú∫", "sub": "ÂÖ•‰ΩèÁ†Å: GE2243 | ÂÆ∂Â∫≠Êàø"}, {"time": "16:00", "type": "warning", "text": "ÈÅøÈõ∑ÊèêÈÜí", "sub": "‰∏çÂéªÂ§ßÂ≠¶Ë∑ØÔºå‰∫∫Â§ö‰∏îÁ¥Ø"}, {"time": "16:30", "type": "sight", "text": "Â••Â∏Ü‰∏≠ÂøÉ & ÊÉÖ‰∫∫Âùù", "sub": "Êó•ËêΩÁªù‰Ω≥ËßÇÊµãÁÇπ"}]}, {"id": "day2", "date": "2026-02-10", "weekday": "Âë®‰∫å", "city": "ÈùíÂ≤õ", "title": "Â∞èÈ∫¶Â≤õ & ÂÖ´Â§ßÂÖ≥", "activities": [{"time": "09:00", "type": "sight", "text": "ÂÖ´Â§ßÂÖ≥È£éÊôØÂå∫", "sub": "‰∏áÂõΩÂª∫Á≠ëÁæ§"}, {"time": "12:00", "type": "food", "text": "ÂçàÈ§êÔºöËàπÊ≠åÈ±ºÊ∞¥È•∫", "sub": "Êé®ËçêÂ¢®È±ºÊ∞¥È•∫"}, {"time": "14:30", "type": "sight", "text": "Â∞èÈ∫¶Â≤õÂÖ¨Âõ≠", "sub": "Áé∞ÂÆûÁâà'Â°ûÂ∞îËææ'ËçâÂú∞"}]}, {"id": "day3", "date": "2026-02-11", "weekday": "Âë®‰∏â", "city": "ÁÉüÂè∞", "title": "ËΩ¨ÊàòÁÉüÂè∞", "activities": [{"time": "10:29", "type": "transport", "text": "ÈùíÂ≤õÁ´ôÂá∫Âèë (C6568)", "sub": "Âèå‰∫∫Á•®: ¬•160 | ËÄÅÁÅ´ËΩ¶Á´ô"}, {"time": "14:00", "type": "hotel", "text": "ÂÖ•‰Ωè: ‰Ω†Â•ΩÁÉüÂè∞‰∫åÈ©¨Ë∑Ø", "sub": "ÂÖ•‰ΩèÁ†Å: DGJ253 | Êµ∑ÊôØÊàø"}, {"time": "18:00", "type": "food", "text": "ÊôöÈ§ê: ÁÉüÂè∞Â∞èÊµ∑È≤ú", "sub": "Êª®Êµ∑ÂπøÂú∫ÈôÑËøë"}]}, {"id": "day4", "date": "2026-02-12", "weekday": "Âë®Âõõ", "city": "ÁÉüÂè∞", "title": "ÂÖªÈ©¨Â≤õÁéØÂ≤õ", "activities": [{"time": "09:00", "type": "transport", "text": "ÂâçÂæÄÂÖªÈ©¨Â≤õ", "sub": "ÊâìËΩ¶Á∫¶40ÂàÜÈíü"}, {"time": "10:30", "type": "activity", "text": "ÁßüÁîµÂä®ËΩ¶ÁéØÂ≤õ", "sub": "Êµ∑Ëû∫Ê¥û„ÄÅÊ®üÂ≤õ„ÄÅÁß¶È£éÂ¥ñ"}, {"time": "16:00", "type": "sight", "text": "ËøîÁ®ãÁúãÊó•ËêΩ", "sub": "Êµ∑È£éÂ§ßÔºåÊ≥®ÊÑè‰øùÊöñ"}]}, {"id": "day5", "date": "2026-02-13", "weekday": "Âë®‰∫î", "city": "È´òÈÇÆ", "title": "ËøîÁ®ã", "activities": [{"time": "15:12", "type": "transport", "text": "D2872 (ÁÉüÂè∞ -> È´òÈÇÆ)", "sub": "‚ö†Ô∏è ÈúÄË¥≠Âèå‰∫∫Á•®"}, {"time": "19:42", "type": "home", "text": "ÊäµËææÈ´òÈÇÆ", "sub": "Ë°åÁ®ãÁªìÊùü"}]}]}.locations;
                const cities = [...new Set(appData.itinerary.map(d => d.city))];

                for (let city of cities) {
                    if (locs[city]) {
                        try {
                            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${locs[city].lat}&longitude=${locs[city].lon}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=7`);
                            const data = await res.json();
                            weatherCache[city] = data.daily;
                        } catch(e) { console.log("Weather error", e); }
                    }
                }
                render();
            }

            function getWeather(city, dateStr) {
                if (!weatherCache[city]) return null;
                const idx = weatherCache[city].time.indexOf(dateStr);
                if (idx === -1) return null;

                const wmo = { 0:"‚òÄÔ∏è", 1:"üå§", 2:"‚òÅÔ∏è", 3:"‚òÅÔ∏è", 45:"üå´", 51:"üåß", 61:"üåß", 71:"‚ùÑÔ∏è" };
                const code = weatherCache[city].weathercode[idx];
                const min = weatherCache[city].temperature_2m_min[idx];
                const max = weatherCache[city].temperature_2m_max[idx];

                let tips = "ËàíÈÄÇ";
                const avg = (min + max)/2;
                if (avg < 5) tips = "Á©øÁæΩÁªíÊúç";
                else if (avg < 15) tips = "Á©øÂ§ßË°£";

                return { icon: wmo[code]||"?", temp: `${min}¬∞~${max}¬∞`, tips: tips };
            }

            function render() {
                const pct = Math.min((appData.budget.spent / appData.budget.total)*100, 100);
                const remain = appData.budget.total - appData.budget.spent;

                let html = `
                    <div class="nav-bar">
                        <div class="nav-title">${appData.subtitle}</div>
                        <div class="nav-large-title">${appData.title}</div>
                    </div>

                    <div class="budget-card">
                        <div class="budget-row">
                            <div><div style="opacity:0.8;font-size:12px">Ââ©‰ΩôÈ¢ÑÁÆó</div><div class="budget-amt">¬•${remain.toFixed(0)}</div></div>
                            <div style="text-align:right"><div style="opacity:0.8;font-size:12px">Â∑≤Áî®</div><div style="font-weight:600">¬•${appData.budget.spent.toFixed(0)}</div></div>
                        </div>
                        <div class="budget-progress"><div class="budget-bar" style="width:${pct}%"></div></div>
                    </div>
                `;

                appData.itinerary.forEach((day, dIdx) => {
                    const w = getWeather(day.city, day.date);
                    let wHtml = w ? `<div class="weather-widget"><span>${w.icon}</span><span class="weather-temp">${w.temp}</span><span class="weather-desc">${w.tips}</span></div>` : `<div class="weather-widget" style="font-size:12px;color:#999">Ê≠£Âú®Ëé∑ÂèñÂ§©Ê∞î...</div>`;

                    let actsHtml = "";
                    day.activities.forEach((act, aIdx) => {
                        actsHtml += `
                        <li class="activity-item">
                            <div class="time-col" contenteditable="${isEditing}" onblur="upd(${dIdx},${aIdx},'time',this.innerText)">${act.time}</div>
                            <div class="content-col">
                                <div class="act-title"><span class="icon">${ICONS[act.type]||'üìç'}</span><span contenteditable="${isEditing}" onblur="upd(${dIdx},${aIdx},'text',this.innerText)">${act.text}</span></div>
                                <div class="act-sub" contenteditable="${isEditing}" onblur="upd(${dIdx},${aIdx},'sub',this.innerText)">${act.sub}</div>
                            </div>
                            <div class="delete-btn" onclick="del(${dIdx},${aIdx})">‚úï</div>
                        </li>`;
                    });

                    html += `
                    <div class="day-container ${isEditing?'editing':''}">
                        <div class="day-header">
                            <div class="day-date">${day.date.split('-')[1]}Êúà${day.date.split('-')[2]}Êó•</div>
                            <div class="day-weekday">${day.weekday} ¬∑ ${day.city}</div>
                        </div>
                        <div class="card">${wHtml}<ul class="activity-list">${actsHtml}</ul></div>
                    </div>`;
                });

                document.getElementById('app').innerHTML = html;
            }

            window.toggleEdit = () => { isEditing = !isEditing; document.getElementById('editBtn').innerText = isEditing ? "ÂÆåÊàê" : "ÁºñËæë"; document.getElementById('saveBtn').style.display = isEditing ? "block" : "none"; document.getElementById('resetBtn').style.display = isEditing ? "block" : "none"; render(); };
            window.upd = (d,a,k,v) => { appData.itinerary[d].activities[a][k] = v; };
            window.del = (d,a) => { if(confirm("Âà†Èô§?")) { appData.itinerary[d].activities.splice(a,1); render(); } };
            window.saveData = () => { localStorage.setItem('appleTrip_final', JSON.stringify(appData)); alert("Â∑≤‰øùÂ≠ò"); isEditing=false; toggleEdit(); };
            window.resetData = () => { if(confirm("ÈáçÁΩÆ?")) { localStorage.removeItem('appleTrip_final'); init(); } };

            init();
        </script>
    </body>
    </html>
    
