
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>è¨€è¨€å’Œå¥¹è€å…¬çš„å±±ä¸œä¹‹æ—…</title>
        <link href="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.css" rel="stylesheet">
        <style>
            :root {
                --bg: #0a0a0c; --card-bg: rgba(30, 30, 35, 0.75); --card-border: rgba(255, 255, 255, 0.1);
                --text-main: #FFFFFF; --text-sub: #9ca3af; --accent: #FF2E63;
                --accent-grad: linear-gradient(135deg, #FF2E63, #9D50FF); --glass: blur(20px);
            }
            body {
                font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
                background-color: var(--bg); color: var(--text-main); margin: 0; padding: 0; padding-bottom: 120px;
                overflow-x: hidden; -webkit-tap-highlight-color: transparent;
                background-image: radial-gradient(circle at 10% 20%, rgba(255, 46, 99, 0.15) 0%, transparent 40%), radial-gradient(circle at 90% 80%, rgba(157, 80, 255, 0.15) 0%, transparent 40%);
            }

            /* åŠ¨ç”» */
            @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.3); } 30% { transform: scale(1); } 45% { transform: scale(1.15); } 60% { transform: scale(1); } }
            @keyframes wave { 0% { box-shadow: 0 0 0 0 rgba(255, 46, 99, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 46, 99, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 46, 99, 0); } }

            .header-box { padding: 60px 24px 20px 24px; }
            .sub-tag { display: inline-block; padding: 6px 12px; border-radius: 20px; background: rgba(255, 46, 99, 0.2); color: #FF80AB; font-size: 11px; font-weight: 700; letter-spacing: 1px; margin-bottom: 10px; border: 1px solid rgba(255, 46, 99, 0.3); }
            .main-title { font-size: 36px; font-weight: 800; line-height: 1.2; background: linear-gradient(to right, #fff, #ffcce0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; display: flex; align-items: center; gap: 10px; }
            .heart { font-size: 30px; animation: heartbeat 1.5s infinite; }

            .status-card { margin: 0 24px 24px; padding: 20px; background: var(--card-bg); border: 1px solid var(--card-border); backdrop-filter: var(--glass); border-radius: 24px; display: flex; justify-content: space-between; align-items: center; }
            .timer-box div:first-child { font-size: 12px; color: var(--text-sub); text-transform: uppercase; }
            .timer-box div:last-child { font-size: 20px; font-weight: 700; margin-top: 4px; font-variant-numeric: tabular-nums; }

            .music-controls { display: flex; gap: 10px; }
            .music-btn { width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.05); border: 1px solid var(--card-border); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
            .music-btn.playing { border-color: #FF2E63; background: rgba(255,46,99,0.2); animation: wave 2s infinite; }
            .qq-btn { width: 44px; height: 44px; border-radius: 50%; background: #31C27C; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }
            .qq-icon { width: 24px; height: 24px; fill: white; }

            .weather-wrap { display: flex; gap: 12px; overflow-x: auto; padding: 0 24px 24px; scrollbar-width: none; }
            .w-card { min-width: 90px; height: 100px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 20px; padding: 12px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; }

            .map-container { margin: 0 24px 24px; height: 200px; background: #1c1c1e; border-radius: 24px; border: 1px solid var(--card-border); overflow: hidden; position: relative; z-index: 1; }
            #map { width: 100%; height: 100%; background: #222; }
            .map-tag { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.7); color:white; padding: 4px 10px; border-radius: 10px; font-size: 10px; z-index: 500; font-weight: bold; }

            .taxi-btns { display: flex; gap: 10px; margin: 0 24px 24px; }
            .taxi-item { flex: 1; background: var(--card-bg); border: 1px solid var(--card-border); padding: 15px; border-radius: 16px; text-align: center; font-weight: 600; cursor: pointer; }

            .check-section { margin: 0 24px 24px; }
            .check-head { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 0 5px; }
            .list-box { background: var(--card-bg); border-radius: 20px; border: 1px solid var(--card-border); overflow: hidden; backdrop-filter: blur(10px); }
            .list-item { padding: 14px 20px; display: flex; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
            .c-circle { width: 20px; height: 20px; border: 2px solid #666; border-radius: 50%; margin-right: 12px; position: relative; }
            .list-item.done .c-circle { border-color: #32D74B; background: rgba(50,215,75,0.2); }
            .list-item.done .c-text { text-decoration: line-through; color: #666; }
            .c-del { margin-left: auto; color: #FF453A; padding: 5px; display: none; }
            .list-item.editing .c-del { display: block; }

            /* --- é’±åŒ… & è´¦å•æ˜ç»† --- */
            .wallet-section { margin: 0 24px 30px; }
            .wallet-card { padding: 24px; background: var(--accent-grad); border-radius: 24px; color: white; position: relative; overflow: hidden; box-shadow: 0 15px 40px -10px rgba(255, 46, 99, 0.4); margin-bottom: 15px; }
            .wallet-card::after { content:''; position: absolute; top:-50%; right:-50%; width: 200px; height: 200px; background: radial-gradient(circle, rgba(255,255,255,0.2), transparent 70%); filter: blur(40px); }
            .add-btn { position: absolute; top: 24px; right: 24px; width: 32px; height: 32px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }

            /* æ–°å¢ï¼šè´¦å•åˆ—è¡¨æ ·å¼ */
            .bill-list { background: var(--card-bg); border-radius: 20px; border: 1px solid var(--card-border); overflow: hidden; margin-top: 10px; }
            .bill-header { padding: 12px 20px; font-size: 12px; color: var(--text-sub); background: rgba(255,255,255,0.03); display: flex; justify-content: space-between; }
            .bill-item { padding: 14px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: space-between; }
            .bill-item:last-child { border-bottom: none; }
            .bill-name { font-size: 15px; color: white; }
            .bill-cost { font-weight: 700; color: #FF2E63; margin-right: 10px; }
            .bill-del { font-size: 18px; color: #666; cursor: pointer; padding: 5px; }
            .bill-del:hover { color: #FF453A; }

            /* è¡Œç¨‹åˆ—è¡¨ */
            .day-group { margin-bottom: 30px; }
            .day-meta { padding: 0 28px 8px; display: flex; justify-content: space-between; align-items: flex-end; }
            .d-date { font-size: 20px; font-weight: 700; color: #fff; }
            .act-row { padding: 16px 20px; display: flex; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
            .act-time { width: 50px; font-weight: 600; color: var(--text-sub); font-size: 14px; }
            .act-info { flex: 1; }
            .act-title { font-size: 16px; margin-bottom: 4px; color: #fff; }
            .act-sub { font-size: 12px; color: var(--text-sub); background: rgba(255,255,255,0.08); padding: 4px 8px; border-radius: 6px; }
            .edit-badge { color: #FF453A; font-size: 12px; margin-left: 10px; display: none; }
            .editing .edit-badge { display: block; }

            .dock { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.15); padding: 10px 20px; border-radius: 100px; display: flex; gap: 20px; z-index: 100; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
            .dock-icon { font-size: 22px; cursor: pointer; opacity: 0.8; color: white; transition: 0.2s; }
            .dock-icon.active { color: #FF2E63; opacity: 1; transform: scale(1.2); }

            /* å¼¹çª— */
            .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 999; display: none; align-items: center; justify-content: center; }
            .modal-bg.show { display: flex; }
            .modal-box { background: #1C1C1E; width: 80%; border-radius: 24px; padding: 24px; border: 1px solid rgba(255,255,255,0.1); }
            input { width: 100%; background: #2C2C2E; border: none; padding: 14px; border-radius: 12px; color: white; margin-bottom: 12px; box-sizing: border-box; font-size: 16px; }
            .btn-row { display: flex; gap: 10px; margin-top: 10px; }
            .btn { flex: 1; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; font-size: 16px; }
            .btn-ok { background: var(--accent); color: white; }
            .taxi-card { background: white; color: black; padding: 40px 20px; border-radius: 24px; text-align: center; width: 85%; }
        </style>
    </head>
    <body>

        <div class="header-box">
            <div class="sub-tag">2026 ROMANTIC TRIP</div>
            <h1 class="main-title">è¨€è¨€å’Œå¥¹è€å…¬çš„å±±ä¸œä¹‹æ—… <span class="heart">â¤ï¸</span></h1>
        </div>

        <div class="status-card">
            <div class="timer-box"><div>Next Adventure</div><div id="countdown">Calculating...</div></div>
            <div class="music-controls">
                <div class="music-btn" id="musicBtn" onclick="toggleMusic()">ğŸµ</div>
                <div class="qq-btn" onclick="openQQMusic()">
                    <svg class="qq-icon" viewBox="0 0 1024 1024"><path d="M512 0C229.248 0 0 229.248 0 512s229.248 512 512 512 512-229.248 512-512S794.752 0 512 0z m243.2 568.32c-2.56 20.48-15.36 33.28-35.84 38.4-15.36 2.56-30.72 5.12-46.08 7.68-15.36 2.56-33.28 0-43.52 12.8-12.8 15.36-12.8 38.4-12.8 58.88-2.56 12.8-2.56 28.16-5.12 40.96-7.68 40.96-46.08 69.12-87.04 64-43.52-5.12-74.24-43.52-69.12-84.48 5.12-38.4 38.4-66.56 76.8-66.56 7.68 0 12.8 0 20.48 2.56 0-5.12 0-12.8 0-17.92V360.96c0-43.52 28.16-81.92 69.12-92.16 43.52-12.8 89.6-23.04 135.68-35.84 25.6-7.68 53.76 7.68 61.44 33.28 7.68 25.6-7.68 53.76-33.28 61.44-33.28 10.24-66.56 17.92-102.4 25.6v128c46.08-12.8 84.48 15.36 97.28 58.88 5.12 17.92 2.56 28.16-5.12 28.16z"/></svg>
                </div>
            </div>
        </div>

        <div class="weather-wrap" id="weatherBox"></div>

        <div class="map-container" onclick="refreshMap()">
            <div class="map-tag">Travel Route</div>
            <div id="map"></div>
        </div>

        <div class="taxi-btns">
            <div class="taxi-item" onclick="showTaxi(0)">ğŸš– é’å²›é…’åº—</div>
            <div class="taxi-item" onclick="showTaxi(1)">ğŸš– çƒŸå°é…’åº—</div>
        </div>

        <div class="check-section">
            <div class="check-head"><span style="font-weight:700;color:white">è¡Œå‰æ¸…å•</span><span style="font-size:12px; color:#FF80AB; cursor:pointer" onclick="openModal('addCheckModal')">ï¼‹ æ·»åŠ </span></div>
            <div class="list-box" id="checkList"></div>
        </div>

        <div class="wallet-section">
            <div class="wallet-card">
                <div class="add-btn" onclick="openModal('exModal')">ï¼‹</div>
                <div style="font-size:13px;opacity:0.8;font-weight:600">REMAINING BUDGET</div>
                <div style="font-size:40px;font-weight:800;margin:10px 0" id="remainBudget">Â¥...</div>
                <div style="font-size:12px;opacity:0.6">Total Spent: Â¥<span id="totalSpent"></span></div>
            </div>

            <div class="bill-list" id="billList"></div>
        </div>

        <div id="itineraryBox"></div>

        <div class="dock">
            <div class="dock-icon" onclick="window.scrollTo({top:0, behavior:'smooth'})">ğŸ </div>
            <div class="dock-icon" id="editBtn" onclick="toggleEdit()">âœ</div>
            <div class="dock-icon" onclick="resetAll()">â†»</div>
        </div>

        <div class="modal-bg" id="actModal"><div class="modal-box"><h3>ç¼–è¾‘æ´»åŠ¨</h3><input id="actTime"><input id="actText"><input id="actSub"><div class="btn-row"><button class="btn" onclick="deleteAct()">åˆ é™¤</button><button class="btn btn-ok" onclick="saveAct()">ä¿å­˜</button></div><div style="text-align:center;margin-top:10px;font-size:12px;color:#666" onclick="closeModal('actModal')">å–æ¶ˆ</div></div></div>
        <div class="modal-bg" id="exModal"><div class="modal-box"><h3>è®°ä¸€ç¬”</h3><input id="exName" placeholder="é¡¹ç›® (å¦‚: å¥¶èŒ¶)"><input id="exCost" type="number" placeholder="é‡‘é¢ (Â¥)"><div class="btn-row"><button class="btn" onclick="closeModal('exModal')">å–æ¶ˆ</button><button class="btn btn-ok" onclick="saveExpense()">ä¿å­˜</button></div></div></div>
        <div class="modal-bg" id="addCheckModal"><div class="modal-box"><h3>æ·»åŠ ç‰©å“</h3><input id="newCheckText"><div class="btn-row"><button class="btn" onclick="closeModal('addCheckModal')">å–æ¶ˆ</button><button class="btn btn-ok" onclick="addCheckItem()">æ·»åŠ </button></div></div></div>
        <div class="modal-bg" id="taxiModal" onclick="this.classList.remove('show')"><div class="taxi-card" onclick="event.stopPropagation()"><div style="color:#888;margin-bottom:10px">SHOW TO DRIVER</div><div style="font-size:26px;font-weight:800;margin-bottom:20px" id="taxiBigName"></div><div style="font-size:18px;background:#f5f5f5;padding:15px;border-radius:12px" id="taxiBigAddr"></div></div></div>

        <audio id="bgm" loop preload="auto" crossorigin="anonymous"><source src="https://music.163.com/song/media/outer/url?id=26217171.mp3" type="audio/mpeg"></audio>

        <script src="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
        <script>
            const DATA = {"title": "è¨€è¨€å’Œå¥¹è€å…¬çš„å±±ä¸œä¹‹æ—…", "subtitle": "2026 ROMANTIC TRIP", "start_date": "2026-02-09 09:10:00", "end_date": "2026-02-13 19:42:00", "bgm_url": "https://music.163.com/song/media/outer/url?id=26217171.mp3", "qq_music_link": "https://y.qq.com/n/ryqq/playlist/8783363024", "budget": {"total": 4000, "fixed_spent": 1740.64}, "weather_locs": {"é’å²›": {"lat": 36.0671, "lon": 120.3826}, "çƒŸå°": {"lat": 37.4638, "lon": 121.4479}, "é«˜é‚®": {"lat": 32.7833, "lon": 119.4333}}, "hotels": [{"city": "é’å²›", "name": "æµ·å‹é…’åº—(äº”å››å¹¿åœºåº—)", "address": "å¸‚å—åŒº å—äº¬è·¯33å·"}, {"city": "çƒŸå°", "name": "ä½ å¥½é…’åº—(æ»¨æµ·å¹¿åœºåº—)", "address": "èŠç½˜åŒº äºŒé©¬è·¯95å·"}], "map_points": {"é«˜é‚®": [32.7833, 119.4333], "é’å²›": [36.0671, 120.3826], "çƒŸå°": [37.4638, 121.4479], "å…»é©¬å²›": [37.4526, 121.6166]}, "default_checklist": [{"text": "èº«ä»½è¯ (åŸä»¶)", "done": false}, {"text": "å­¦ç”Ÿè¯", "done": false}, {"text": "å……ç”µå®", "done": false}, {"text": "è‡ªæ‹æ†", "done": false}], "itinerary": [{"date": "2026-02-09", "weekday": "å‘¨ä¸€", "city": "é’å²›", "title": "æŠµè¾¾ & å…¥ä½", "activities": [{"time": "09:10", "type": "transport", "text": "é«˜é‚®ç«™å‡ºå‘", "sub": "D2866 (05è½¦11A)"}, {"time": "14:30", "type": "hotel", "text": "æµ·å‹é…’åº—å…¥ä½", "sub": "ç : GE2243"}, {"time": "16:30", "type": "sight", "text": "å¥¥å¸†ä¸­å¿ƒæ—¥è½", "sub": "æƒ…äººå"}]}, {"date": "2026-02-10", "weekday": "å‘¨äºŒ", "city": "é’å²›", "title": "å°éº¦å²› & å…«å¤§å…³", "activities": [{"time": "09:00", "type": "sight", "text": "å…«å¤§å…³", "sub": "ä¸‡å›½å»ºç­‘"}, {"time": "14:30", "type": "sight", "text": "å°éº¦å²›", "sub": "è‰åœ°éŸ³ä¹ä¼š"}]}, {"date": "2026-02-11", "weekday": "å‘¨ä¸‰", "city": "çƒŸå°", "title": "è½¬æˆ˜çƒŸå°", "activities": [{"time": "10:29", "type": "transport", "text": "å‰å¾€çƒŸå°", "sub": "C6568 (04è½¦08D)"}, {"time": "14:00", "type": "hotel", "text": "ä½ å¥½é…’åº—å…¥ä½", "sub": "ç : DGJ253"}]}, {"date": "2026-02-12", "weekday": "å‘¨å››", "city": "çƒŸå°", "title": "å…»é©¬å²›ç¯å²›", "activities": [{"time": "10:30", "type": "activity", "text": "ç§Ÿè½¦ç¯å²›", "sub": "æµ·èºæ´"}, {"time": "16:00", "type": "sight", "text": "çœ‹æ—¥è½", "sub": "è¿”ç¨‹"}]}, {"date": "2026-02-13", "weekday": "å‘¨äº”", "city": "é«˜é‚®", "title": "è¿”ç¨‹", "activities": [{"time": "15:12", "type": "transport", "text": "D2872 è¿”ç¨‹", "sub": "çƒŸå°->é«˜é‚®"}]}]};
            let state = { expenses: [], checklist: JSON.parse(JSON.stringify(DATA.default_checklist)), itinerary: JSON.parse(JSON.stringify(DATA.itinerary)), editing: false };
            let target = {d:-1, a:-1};
            let map = null;

            async function init() {
                const local = localStorage.getItem('billing_app_v1');
                if(local) state = {...state, ...JSON.parse(local)};

                renderTimer(); renderWeather(); renderBudget(); renderChecklist(); renderItinerary();
                setTimeout(initMap, 500);
            }

            // === éŸ³ä¹ ===
            function toggleMusic() { const audio = document.getElementById('bgm'), btn = document.getElementById('musicBtn'); if(audio.paused){ audio.play().then(()=>btn.classList.add('playing')).catch(()=>{}); }else{ audio.pause(); btn.classList.remove('playing'); } }
            function openQQMusic() { window.location.href = DATA.qq_music_link; }

            // === æ ¸å¿ƒå‡çº§ï¼šè´¦å•æ˜ç»† ===
            function renderBudget() {
                // 1. è®¡ç®—æ€»é¢
                const u = state.expenses.reduce((s,i)=>s+Number(i.cost),0);
                const t = DATA.budget.fixed_spent + u;
                document.getElementById('remainBudget').innerText = `Â¥${(DATA.budget.total - t).toFixed(0)}`;
                document.getElementById('totalSpent').innerText = t.toFixed(0);

                // 2. æ¸²æŸ“æ˜ç»†åˆ—è¡¨
                const list = document.getElementById('billList');
                if (state.expenses.length === 0) {
                    list.innerHTML = '<div style="padding:15px;text-align:center;font-size:12px;color:#666">æš‚æ— æ¶ˆè´¹è®°å½•</div>';
                } else {
                    // åè½¬æ•°ç»„ï¼Œæœ€æ–°çš„æ˜¾ç¤ºåœ¨æœ€ä¸Šé¢
                    list.innerHTML = state.expenses.map((ex, i) => `
                        <div class="bill-item">
                            <div class="bill-name">${ex.name}</div>
                            <div style="display:flex;align-items:center">
                                <div class="bill-cost">-Â¥${ex.cost}</div>
                                <div class="bill-del" onclick="delExpense(${i})">âœ•</div>
                            </div>
                        </div>
                    `).reverse().join('');
                }
            }

            function saveExpense() {
                const n = document.getElementById('exName').value;
                const c = document.getElementById('exCost').value;
                if(n && c) {
                    state.expenses.push({name:n, cost:c});
                    save(); renderBudget(); closeModal('exModal');
                    document.getElementById('exName').value=''; document.getElementById('exCost').value='';
                }
            }

            function delExpense(reverseIndex) {
                // å› ä¸ºæ˜¾ç¤ºæ—¶ reverse äº†ï¼Œåˆ é™¤æ—¶è¦æ‰¾å›åŸå§‹ç´¢å¼•
                const realIndex = state.expenses.length - 1 - reverseIndex;
                if(confirm('åˆ é™¤è¿™ç¬”è®°å½•? é’±ä¼šé€€å›é¢„ç®—ã€‚')) {
                    state.expenses.splice(realIndex, 1);
                    save(); renderBudget();
                }
            }

            // === åœ°å›¾ ===
            function initMap() { if(map) return; map=L.map('map',{zoomControl:false,attributionControl:false}).setView([36.5,121.0],7); L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{maxZoom:19}).addTo(map); const pts=[]; Object.values(DATA.map_points).forEach(p=>{L.circleMarker(p,{radius:6,color:'#FF2E63',fillColor:'#FF2E63',fillOpacity:1}).addTo(map);pts.push(p)}); if(pts.length>1)L.polyline(pts,{color:'#FF2E63',weight:3,dashArray:'5,5'}).addTo(map); }
            function refreshMap(){ if(map) map.invalidateSize(); }

            // === ç¼–è¾‘ ===
            function toggleEdit(){ state.editing=!state.editing; document.getElementById('editBtn').classList.toggle('active',state.editing); renderItinerary(); renderChecklist(); }
            function renderItinerary() { document.getElementById('itineraryBox').innerHTML=state.itinerary.map((d,i)=>`<div class="day-group"><div class="day-meta"><div class="d-date">${d.date.slice(5)} ${d.weekday}</div><div class="d-city" style="color:#FF80AB;font-weight:700">${d.city}</div></div><div class="list-box">${d.activities.map((a,j)=>`<div class="act-row" onclick="clickAct(${i},${j})"><div class="act-time">${a.time}</div><div class="act-info"><div class="act-title">${a.text}</div><div class="act-sub">${a.sub}</div></div>${state.editing?'<div class="edit-badge">âœ</div>':''}</div>`).join('')}<div style="padding:15px;text-align:center;color:#FF80AB;font-size:12px;border-top:1px solid rgba(255,255,255,0.05);cursor:pointer" onclick="addAct(${i})">ï¼‹ æ·»åŠ æ´»åŠ¨</div></div></div>`).join(''); }
            function clickAct(d,a){ target={d,a}; const act=state.itinerary[d].activities[a]; document.getElementById('actTime').value=act.time; document.getElementById('actText').value=act.text; document.getElementById('actSub').value=act.sub; openModal('actModal'); }
            function saveAct(){ const t=document.getElementById('actTime').value, tx=document.getElementById('actText').value, s=document.getElementById('actSub').value; state.itinerary[target.d].activities[target.a]={time:t,text:tx,sub:s}; save(); renderItinerary(); closeModal('actModal'); }
            function deleteAct(){ if(confirm('åˆ é™¤?')){ state.itinerary[target.d].activities.splice(target.a,1); save(); renderItinerary(); closeModal('actModal'); } }
            function addAct(d){ state.itinerary[d].activities.push({time:"00:00",text:"æ–°è®¡åˆ’",sub:"ç‚¹å‡»ä¿®æ”¹"}); save(); renderItinerary(); clickAct(d,state.itinerary[d].activities.length-1); }

            // === æ¸…å• ===
            function renderChecklist(){ document.getElementById('checkList').innerHTML=state.checklist.map((item,i)=>`<div class="list-item ${item.done?'done':''} ${state.editing?'editing':''}"><div class="c-circle" onclick="toggleCheck(${i})"></div><div class="c-text" style="flex:1;color:white;margin-left:12px" onclick="toggleCheck(${i})">${item.text}</div>${state.editing?`<div class="c-del" onclick="delCheck(${i})">âœ•</div>`:''}</div>`).join(''); }
            function toggleCheck(i){ state.checklist[i].done=!state.checklist[i].done; save(); renderChecklist(); }
            function delCheck(i){ state.checklist.splice(i,1); save(); renderChecklist(); }
            function addCheckItem(){ const t=document.getElementById('newCheckText').value; if(t){ state.checklist.push({text:t,done:false}); save(); renderChecklist(); closeModal('addCheckModal'); document.getElementById('newCheckText').value=''; } }

            // === é€šç”¨ ===
            function renderTimer(){ setInterval(()=>{ const diff=new Date(DATA.start_date)-new Date(); const d=Math.floor(diff/86400000); document.getElementById('countdown').innerText=diff>0?`${d} DAYS`:"Enjoy!"; },1000); }
            function renderWeather(){ const box=document.getElementById('weatherBox'); box.innerHTML=Object.keys(DATA.weather_locs).map(c=>`<div class="w-card" id="w-${c}"><div style="font-size:12px;opacity:0.7">${c}</div><div>--Â°</div></div>`).join(''); Object.keys(DATA.weather_locs).forEach(async c=>{ try{const{lat,lon}=DATA.weather_locs[c];const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);const d=await r.json();const w={0:"â˜€ï¸",1:"ğŸŒ¤",2:"â˜ï¸",3:"â˜ï¸",51:"ğŸŒ§"};document.getElementById(`w-${c}`).innerHTML=`<div style="font-size:12px;font-weight:700;color:#FF80AB">${c}</div><div style="font-size:24px">${w[d.current_weather.weathercode]||"?"}</div><div style="font-size:18px">${Math.round(d.current_weather.temperature)}Â°</div>`;}catch(e){} }); }
            function openModal(id){ document.getElementById(id).classList.add('show'); }
            function closeModal(id){ document.getElementById(id).classList.remove('show'); }
            function showTaxi(i){ const h=DATA.hotels[i]; document.getElementById('taxiBigName').innerText=h.name; document.getElementById('taxiBigAddr').innerText=h.address; openModal('taxiModal'); }
            function save(){ localStorage.setItem('billing_app_v1', JSON.stringify(state)); }
            function resetAll(){ if(confirm('é‡ç½®æ‰€æœ‰æ•°æ®?')){ localStorage.removeItem('billing_app_v1'); location.reload(); } }

            init();
        </script>
    </body>
    </html>
    